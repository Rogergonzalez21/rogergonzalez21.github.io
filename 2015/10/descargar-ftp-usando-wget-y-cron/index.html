<!DOCTYPE html>
<html lang="en">

<head>
  <!-- ## for client-side less
  <link rel="stylesheet/less" type="text/css" href="http://rogerandresgonzalez.com.ve/theme/css/style.less">
  <script src="http://cdnjs.cloudflare.com/ajax/libs/less.js/1.7.3/less.min.js" type="text/javascript"></script>
  -->
  <link rel="stylesheet" type="text/css" href="http://rogerandresgonzalez.com.ve/theme/css/style.css">
  <link rel="stylesheet" type="text/css" href="http://rogerandresgonzalez.com.ve/theme/css/pygments.css">
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=PT+Sans|PT+Serif|PT+Mono">
  <link rel="stylesheet" type="text/css" href="http://rogerandresgonzalez.com.ve/theme/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="http://rogerandresgonzalez.com.ve/theme/css/youtube.css">
  <link rel="shortcut icon" href="http://rogerandresgonzalez.com.ve/images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="http://rogerandresgonzalez.com.ve/images/favicon.ico" type="image/x-icon">
  <link rel="alternate" hreflang="es" href="rogerandresgonzalez.com.ve/es/" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Roger Andrés González">
  <meta name="description" content="Posts and writings by Roger Andrés González. Pythonista. Love to eat. Critic. Music lover. Always wanting to learn more.">
  <meta property="og:image" content="http://rogerandresgonzalez.com.ve/images/yo.png" />
  <meta property="og:image:type" content="image/png" />
  <meta name="twitter:image" content="http://rogerandresgonzalez.com.ve/images/yo.png" />
  <meta itemprop="image" content="http://rogerandresgonzalez.com.ve/images/yo.png" />
  <link href="http://rogerandresgonzalez.com.ve/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Roger Andrés González - rogerandresgonzalez.com.ve Atom" />

<meta name="keywords" content="wget, cron, ftp, descargar, script, bash, tutorial">

  <title>
    Roger Andrés González - rogerandresgonzalez.com.ve
&ndash; ¿Cómo descargar automáticamente de un FTP usando wget y cron?  </title>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69257856-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>

<body>
  <aside class="gray_background">
    <div id="user_meta">
      <a href="http://rogerandresgonzalez.com.ve">
        <img src="http://rogerandresgonzalez.com.ve/images/yo.png" alt="logo">
        </a>
        <h2><a href="http://rogerandresgonzalez.com.ve">Roger Andrés González</a></h2>
        <p>Pythonista. Love to eat. Critic. Music lover. Always wanting to learn more.</p>
        <ul>
        <ul class="social">
        <li><a class="sc-linkedin white" href="https://ve.linkedin.com/in/rogergonzalez21/en" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-github white" href="https://github.com/Rogergonzalez21" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-envelope-o white" href="mailto:me@rogerandresgonzalez.com.ve" target="_blank"><i class="fa fa-envelope-o"></i></a></li>
        <li><a class="sc-twitter white" href="https://twitter.com/RogerGonzalez21" target="_blank"><i class="fa fa-twitter"></i></a></li>
        </ul>
      </ul>
    </div>
  </aside>

  <main>

    <header>
      <p>
        / <a href="http://rogerandresgonzalez.com.ve">Home</a> /
        <a href="/pages/about/">About</a> /
        <a href="/pages/curriculum/">Curriculum Vitae</a> /
        <a href="/archives/">Archive</a> /
        <a href="/category/">Category</a> /
        <a href="/tag/">Tags</a> /
        <a href="/es/">Español</a> /
        <a href="http://rogerandresgonzalez.com.ve/feeds/all.atom.xml">Atom</a>
        </p>
    </header>
<!--
    <header>
      <p>
      <a href="http://rogerandresgonzalez.com.ve">Index</a> &brvbar; <a href="http://rogerandresgonzalez.com.ve/archives.html">Archives</a>
      &brvbar; <a href="http://rogerandresgonzalez.com.ve/feeds/all.atom.xml">Atom</a>
      </p>
    </header>
-->
<article>
  <div class="article_title">
    <h3><a href="http://rogerandresgonzalez.com.ve/2015/10/descargar-ftp-usando-wget-y-cron/">¿Cómo descargar automáticamente de un FTP usando wget y cron?</a></h3>
  </div>
  <div class="article_text">
    <p>Hace unos días me mandaron a configurar una PC prehistorica para hacer respaldos automáticos de un servidor web. Una antigua Intel Dual Core con 2GB de Ram y un HDD de 320GB (los respaldos no son tan pesados, 8GB a lo sumo).</p>
<p>Lo mejor del proyecto: Me dieron total libertad. Por eso, decidí instalar <a class="reference external" href="http://lubuntu.net/">Lubuntu 15.10</a> (recien salido del horno) en contra del equipo de Windowseros TI que hay en la empresa.</p>
<p>Ya que la PC tenía Lubuntu, me dispuse a buscar opciones para descargar por FTP, y me consigo con wget, la herramienta de descargas que viene preinstalada en todas las distro Debian-based.</p>
<div class="section" id="que-es-wget">
<h2>¿Qué es wget?</h2>
<p><a class="reference external" href="https://es.wikipedia.org/wiki/GNU_Wget">wget</a> es una herramienta libre que permite la descarga de contenidos desde servidores web de una forma simple. Se caracteriza por ser muy <strong>robusta</strong> desde su lanzamiento en 1996 (justo en el boom de popularidad de la web).</p>
<p>¡Ya tengo la herramienta para hacer los backups! y lo mejor es que <strong>viene incluida en la distribución</strong>, por lo que no tengo que instalar paquetes externos.</p>
<p>Ahora, para programar las descargas me propuse usar <strong>cron</strong>.</p>
</div>
<div class="section" id="que-es-cron">
<h2>¿Qué es cron?</h2>
<p><a class="reference external" href="https://es.wikipedia.org/wiki/Cron_%28Unix%29">cron</a> es un <a class="reference external" href="https://es.wikipedia.org/wiki/Demonio_%28inform%C3%A1tica%29">demonio</a> que ejecuta procesos o <a class="reference external" href="https://es.wikipedia.org/wiki/Script">scripts</a> a cierto minuto, hora, dia, semana o mes.</p>
<p>Ya que sabía lo que tenía que hacer, solo faltaba ponerme manos a la obra.</p>
</div>
<div class="section" id="manos-a-la-obra">
<h2>Manos a la obra</h2>
<p>Primero, tenía que crear el script de <a class="reference external" href="https://es.wikipedia.org/wiki/Bash">bash</a> <code>(.sh)</code> que se iba a ejecutar. El script tiene que:</p>
<ul class="simple">
<li>Acceder a la carpeta de backups</li>
<li>Crear una carpeta con la fecha del día del backup</li>
<li>Descargar todo del FTP</li>
</ul>
<p>Ok, ¡Empecemos!</p>
<div class="highlight"><pre><span class="c">#! /bin/bash</span>

<span class="nv">today</span><span class="o">=</span><span class="sb">`</span>date +<span class="s2">&quot;%d_%m_%Y&quot;</span><span class="sb">`</span>

<span class="nb">cd</span> ~/backups
mkdir <span class="nv">$today</span>

<span class="nb">cd</span> <span class="nv">$today</span>
user@pc:~<span class="nv">$ </span>mailx -s <span class="s2">&quot;¡Backup comenzado!&quot;</span> <span class="s2">&quot;correo_destinatario@servidor.com&quot;</span> &lt; /dev/null
wget --timeout <span class="m">20</span> -m -nH --user <span class="s2">&quot;ftpuser&quot;</span> --password <span class="s2">&quot;ftppassword&quot;</span> ftp://ftpserver.com
user@pc:~<span class="nv">$ </span>mailx -s <span class="s2">&quot;¡Backup terminado!&quot;</span> <span class="s2">&quot;correo_destinatario@servidor.com&quot;</span> &lt; /dev/null
</pre></div>
<p>¡No te asustes! Voy a explicar paso a paso lo que hace cada uno de los comandos.</p>
<ul class="simple">
<li><code>#! /bin/bash</code>: Sirve para indicar que lo que viene es un script de bash.</li>
<li><code>today=`date +&quot;%d_%m_%Y&quot;`</code>: Guarda la fecha de hoy, en formato 'dia_mes_Año', en la variable 'today'.</li>
<li><code>cd ~/backups</code>:  Entra a una carpeta llamada 'backups', que voy a crear más adelante.</li>
<li><code>mkdir $today</code>: Crea una carpeta con el día de hoy ('dia_mes_Año').</li>
<li><code>cd $today</code>: Accede a la carpeta creada.</li>
<li><code>mailx -s</code>: mailx es un programa que se usa para mandar correos. En <a class="reference external" href="http://rogerandresgonzalez.com.ve/2015/10/enviar-un-mail-con-mailx/">esta</a> entrada puedes saber mas de eso.</li>
</ul>
<p>Aquí me voy a detener un poco y explicar pausadamente.</p>
<ul class="simple">
<li><code>wget --timeout 20 -m -nh</code>: Ejecuta wget con los parámetros:<ul>
<li><code>--timeout 20</code>, para que reintente luego de 20 segundos de inactividad.</li>
<li><code>-m</code> para especificar que está haciendo un mirror.</li>
<li><code>-nH</code>, que especifica que no cree una subcarpeta, sino que descargue todo en donde está.</li>
</ul>
</li>
<li><code>--user &quot;ftpuser&quot; --password &quot;ftppassword&quot; ftp://ftpserver.com</code>: Son los datos de conexión de nuestro FTP. Debemos reemplazar cada uno de los campos con nuestros propios datos.</li>
</ul>
</div>
<div class="section" id="ya-que-tenemos-nuestro-script-configuremos-cron">
<h2>Ya que tenemos nuestro script, configuremos cron</h2>
<p>La configuración de cron es muchisimo mas sencilla. En nuestro terminal colocamos:</p>
<div class="highlight"><pre>crontab -e
</pre></div>
<p>(Aveces advierte que no tienes un editor predeterminado. Elegimos 'nano' o el de nuestra preferencia).</p>
<p>Se va a abrir nuestro archivo crontab. Si vamos a la última parte, veremos que podemos agregar nuevas instrucciones.</p>
<p>Los formatos de las instrucciones de crontab son las siguientes:</p>
<div class="highlight"><pre>a b c d e /ruta/del/script.sh
</pre></div>
<p>Donde:</p>
<ul class="simple">
<li>a = minuto (0-59)</li>
<li>b = hora (0-23, 0 = medianoche)</li>
<li>c = dia (1-31)</li>
<li>d = mes (1-12)</li>
<li>e = dia de la semana (0,6, 0 = domingo)</li>
</ul>
<p>También podemos colocar '*' en día, mes y día de la semana, para especificar &quot;cualquiera&quot;.</p>
<p>Con esta información, construí mi crontab:</p>
<div class="highlight"><pre><span class="m">30</span> <span class="m">17</span> * * 2,4 /scripts/backup.sh
</pre></div>
<p>El script será ejecutado cada <strong>martes</strong> y <strong>jueves</strong>, a las <strong>5:30PM</strong>. <a class="reference external" href="https://help.ubuntu.com/community/CronHowto">Aquí</a> tienes más información para crear tus propios cron.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusión</h2>
<p>wget y cron son herramientas poderosas que vienen con nuestros sistemas operativos Linux, que con los conocimientos correctos pueden ser nuestras mejores amigas.</p>
<p>cron puede ser usado para muchas cosas de automatización, y wget tiene muchísimas más opciones además de descargar de un FTP. Te invito a leer cada uno de sus manuales (<code>man wget</code> y <code>man cron</code>).</p>
<p>Hasta la próxima.</p>
</div>

  </div>
  <div class="article_meta">
    <p>Posted on: 30/10/2015</p>
    <p>Category: <a href="http://rogerandresgonzalez.com.ve/category/tecnologia/">Tecnología</a>
 &ndash; Tags:
      <a href="http://rogerandresgonzalez.com.ve/tag/wget/">wget</a>,      <a href="http://rogerandresgonzalez.com.ve/tag/cron/">cron</a>,      <a href="http://rogerandresgonzalez.com.ve/tag/ftp/">ftp</a>,      <a href="http://rogerandresgonzalez.com.ve/tag/descargar/">descargar</a>,      <a href="http://rogerandresgonzalez.com.ve/tag/script/">script</a>,      <a href="http://rogerandresgonzalez.com.ve/tag/bash/">bash</a>,      <a href="http://rogerandresgonzalez.com.ve/tag/tutorial/">tutorial</a>    </p>
  </div>

  <div id="article_comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_identifier = "2015/10/descargar-ftp-usando-wget-y-cron/";
        (function() {
             var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
             dsq.src = 'http://rogergonzalez21.disqus.com/embed.js';
             (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
         })();
    </script>
  </div>

</article>


    <div id="ending_message">
      <p>&copy; Roger Andrés González. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. Theme by Giulio Fidente on <a href="https://github.com/gfidente/pelican-svbhack" target="_blank">github</a>. Forked and modified by Roger Gonzalez on <a href="https://github.com/Rogergonzalez21/pelican-svbhack" target="_blank">github</a>  </p>
    </div>
  </main>
</body>
</html>