<!DOCTYPE html>
<html lang="en">

<head>
  <!-- ## for client-side less
  <link rel="stylesheet/less" type="text/css" href="http://rogergonzalez21.github.io/theme/css/style.less">
  <script src="http://cdnjs.cloudflare.com/ajax/libs/less.js/1.7.3/less.min.js" type="text/javascript"></script>
  -->
  <link rel="stylesheet" type="text/css" href="http://rogergonzalez21.github.io/theme/css/style.css">
  <link rel="stylesheet" type="text/css" href="http://rogergonzalez21.github.io/theme/css/pygments.css">
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=PT+Sans|PT+Serif|PT+Mono">
  <link rel="stylesheet" type="text/css" href="http://rogergonzalez21.github.io/theme/css/font-awesome.min.css">
  <link rel="shortcut icon" href="http://rogergonzalez21.github.io/images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="http://rogergonzalez21.github.io/images/favicon.ico" type="image/x-icon">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Roger González">
  <meta name="description" content="Posts and writings by Roger González">


<meta name="keywords" content="deploy, django, openshift, python, tutorial">

  <title>
    Roger González - rogergonzalez.com.ve
&ndash; ¿Cómo hacer un deploy de una aplicación de Django a Openshift?  </title>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69257856-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>

<body>
  <aside class="gray_background">
    <div id="user_meta">
      <a href="http://rogergonzalez21.github.io">
        <img src="http://rogergonzalez21.github.io/images/yo.png" alt="logo">
        </a>
        <h2><a href="http://rogergonzalez21.github.io">Roger González</a></h2>
        <p>Pythonista. Love to eat. Critic. Music lover. Always wanting to learn more.</p>
        <ul>
        <ul class="social">
        <li><a class="sc-linkedin white" href="https://ve.linkedin.com/in/rogergonzalez21" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-github white" href="https://github.com/Rogergonzalez21" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-envelope-o white" href="mailto:rogergonzalez21@gmail.com" target="_blank"><i class="fa fa-envelope-o"></i></a></li>
        </ul>
      </ul>
    </div>
  </aside>

  <main>

    <header>
      <p>
        / <a href="http://rogergonzalez21.github.io">Home</a> /
        <a href="/pages/about/">About</a> /
        <a href="/pages/curriculum/">Curriculum Vitae</a> /
        <a href="/archives/">Archive</a> /
        <a href="/category/">Category</a> /
        <a href="/tag/">Tags</a> /
        <a href="/es/">Español</a> /
        </p>
    </header>
<!--
    <header>
      <p>
      <a href="http://rogergonzalez21.github.io">Index</a> &brvbar; <a href="http://rogergonzalez21.github.io/archives.html">Archives</a>
      </p>
    </header>
-->
<article>
  <div class="article_title">
    <h3><a href="http://rogergonzalez21.github.io/drafts/deploy-django-a-openshift/">¿Cómo hacer un deploy de una aplicación de Django a Openshift?</a></h3>
  </div>
  <div class="article_text">
    <p>Algo muy importante luego de que haces tu aplicación en Django es hacer el deploy. ¿Como la gente va a usar tu aplicación <strong>si no pueden llegar a ella</strong>?.</p>
<p>Aquí llega Red Hat al rescate con su servicio <a class="reference external" href="https://es.wikipedia.org/wiki/Computaci%C3%B3n_en_la_nube#Plataforma_como_servicio_">PaaS</a>, <a class="reference external" href="https://openshift.redhat.com/">OpenShift</a>.</p>
<div class="section" id="que-es-openshift-eso-con-que-se-come">
<h2>¿Qué es OpenShift? ¿Eso con qué se come?</h2>
<p>OpenShift es el servicio de &quot;Plataforma-como-servicio&quot; de Red Hat. Simple, ¿no?. Lo más importante que tiene OpenShift es que con su cuenta gratuita <strong>se pueden tener hasta 3 aplicaciones en vivo</strong>, incluso con <strong>dominios propios</strong>, características que lo convierten en una de las mejores opciones para hacer deploy de aplicaciones web.</p>
</div>
<div class="section" id="ya-cree-mi-cuenta-en-openshift-ahora-que">
<h2>Ya creé mi cuenta en OpenShift, ¿Ahora qué?</h2>
<p>Primero, tienes que <a class="reference external" href="https://developers.openshift.com/en/getting-started-overview.html">configurar tu cuenta</a>. Si no configuras tu cuenta, no podrás acceder a tus aplicaciones
via Git.</p>
<p>Luego, desde tu panel de control debes <strong>crear tu primera aplicación</strong>.</p>
<img alt="Añadir aplicación" src="http://rogergonzalez21.github.io/images/deploy_django/add_aplication.png" />
<p>Para efectos de este tutorial, vamos a crear una aplicación de Python 2.7.</p>
<img alt="Python 2.7" src="http://rogergonzalez21.github.io/images/deploy_django/python_2.7.png" />
<p>Llenamos toda la información que nos pide, y luego esperamos a que nos lleve al panel de control de la aplicación.
Una vez en el panel de control, añadimos el cartucho de MySQL y el de PHPMyAdmin (opcional).</p>
<p>¡Ahora podemos clonar nuestro repositorio en OpenShift vía Git! En la parte derecha del panel de control
nos dice &quot;Source code&quot;. Ese es el link de nuestro repositorio, al que podemos acceder con &quot;git clone&quot; desde el terminal.</p>
<p>Voy a asumir que ya tienes Git instalado y usas Ubuntu.</p>
<div class="highlight"><pre>user@pc:~/<span class="nv">$ </span>git clone el-link-de-tu-repositorio-aqui repo
user@pc:~/<span class="nv">$ </span><span class="nb">cd </span>repo
</pre></div>
<p>Si haces <code>ls</code>:</p>
<div class="highlight"><pre>tuProyecto/
    +---wsgi.py
    +---setup.py
    *---.openshift/
</pre></div>
<p>Allí vas a pegar toda tu aplicación (si tienes una), o vas a crear una nueva.</p>
<p>Ahora viene lo básico. Crear tu virtualenv, activarlo, instalar las dependencias desde tu requirements.txt,
etc, etc, etc...</p>
<p>Luego de que hagas todo esto, coloca esto en tu terminal:</p>
<div class="highlight"><pre>user@pc:~/repo<span class="nv">$ </span>mkdir wsgi
user@pc:~/repo<span class="nv">$ </span>mkdir wsgi/static
user@pc:~/repo<span class="nv">$ </span>touch wsgi/static/.gitkeep
</pre></div>
<p>Esto lo usaremos más adelante, es bueno tenerlo listo.</p>
<p>Si has seguido todos los pasos correctamente, deberías tener el siguiente esquema de proyecto:</p>
<div class="highlight"><pre>tuProyecto/
+---wsgi/
<span class="p">|</span>   +---static/
<span class="p">|</span>       +---.gitkeep
+---wsgi.py
+---setup.py
+---.openshift/
+---tuProyectoDjango/
<span class="p">|</span>   +----__init__.py
<span class="p">|</span>   +----urls.py
<span class="p">|</span>   +----settings.py
<span class="p">|</span>   +----wsgi.py
+---+tuAppDjango/
    +----__init__.py
    +----models.py
    +----views.py
    +----tests.py
    +----migrations
         +---__init__.py
</pre></div>
<div class="section" id="ya-el-proyecto-esta-configurado-empecemos-con-el-wsgi">
<h3>Ya el proyecto está configurado. Empecemos con el <a class="reference external" href="http://python.org.ar/wiki/WSGI">wsgi</a>.</h3>
<p>Primero, debes editar el activho wsgi.py que vino directamente del repositorio de OpenShift con lo siguiente:</p>
<p>¡No olvides de reemplazar <strong>'tuProyectoDjango'</strong> con el nombre de tu proyecto!</p>
<div class="highlight"><pre><span class="c">#!/usr/bin/python</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">virtenv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;OPENSHIFT_PYTHON_DIR&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;/virtenv/&#39;</span>
<span class="n">virtualenv</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">virtenv</span><span class="p">,</span> <span class="s">&#39;bin/activate_this.py&#39;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="nb">execfile</span><span class="p">(</span><span class="n">virtualenv</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">__file__</span><span class="o">=</span><span class="n">virtualenv</span><span class="p">))</span>
<span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="kn">from</span> <span class="nn">tuProyectoDjango.wsgi</span> <span class="kn">import</span> <span class="n">application</span>
</pre></div>
<p>Crea un archivo que se llame &quot;build&quot; (así, sin extensión), añade los siguientes scripts y guardalos en <code>.openshift/action_hooks</code>. Estos van a ser ejecutados cada vez que se haga el deployment de la aplicación.</p>
<div class="highlight"><pre><span class="c">#!/bin/bash</span>
<span class="c">#this is .openshift/action/hooks/build</span>
<span class="c">#remember to make it +x so openshift can run it.</span>
<span class="k">if</span> <span class="o">[</span> ! -d <span class="si">${</span><span class="nv">OPENSHIFT_DATA_DIR</span><span class="si">}</span>media <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    mkdir -p <span class="si">${</span><span class="nv">OPENSHIFT_DATA_DIR</span><span class="si">}</span>media
<span class="k">fi</span>
ln -snf <span class="si">${</span><span class="nv">OPENSHIFT_DATA_DIR</span><span class="si">}</span>media <span class="nv">$OPENSHIFT_REPO_DIR</span>/wsgi/static/media

<span class="c">######################### end of file</span>

<span class="c">#!/bin/bash</span>
<span class="c">#this one is the deploy hook .openshift/action_hooks/deploy</span>
<span class="nb">source</span> <span class="nv">$OPENSHIFT_HOMEDIR</span>/python/virtenv/bin/activate
<span class="nb">cd</span> <span class="nv">$OPENSHIFT_REPO_DIR</span>
<span class="nb">echo</span> <span class="s2">&quot;Executing &#39;python manage.py migrate&#39;&quot;</span>
python manage.py migrate
<span class="nb">echo</span> <span class="s2">&quot;Executing &#39;python manage.py collectstatic --noinput&#39;&quot;</span>
python manage.py collectstatic --noinput

<span class="c">########################### end of file</span>
</pre></div>
<p>El primero crea la carpeta de &quot;media&quot; en el root del proyecto de OpenShift si esta no existe y crea un enlace simbólico a la ruta <code>/wsgi/static/media</code> (recuerdan cuando creamos <code>/wsgi/static/</code>?).</p>
<p>El segundo, activa la virtualenv en OpenShift, ejecuta las migraciones y el <a class="reference external" href="https://docs.djangoproject.com/en/1.8/ref/contrib/staticfiles/#collectstatic">collectstatic</a>.</p>
<p>Debes añadir el atributo <code>+x</code> a <code>.openshift/action_hooks/build</code>, por lo que tienes que ejecutar lo siguiente en el terminal:</p>
<div class="highlight"><pre>user@pc:~/repo<span class="nv">$ </span>chmod +x .openshift/action_hooks/build
</pre></div>
<p>Esto lo vuelve un archivo ejecutable.</p>
</div>
<div class="section" id="seguimos-con-las-modificaciones-en-settings">
<h3>Seguimos con las modificaciones en 'settings'</h3>
<p>Ya que el wsgi y los hooks están listos, tienes que modificar tu archivo 'settings' para que apunte en donde estan tus archivos 'static', 'media' y 'template':</p>
<p>Todas estas configuraciones están hechas para correr en los sitios predeterminados. Si hiciste algún cambio, refléjalo en tus settings.</p>
<p>¡Recuerda reemplazar <strong>'tuAppDjango'</strong> con el nombre de tu app!</p>
<div class="highlight"><pre><span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s">&#39;/static/&#39;</span>
<span class="n">MEDIA_URL</span> <span class="o">=</span> <span class="s">&#39;/media/&#39;</span>
<span class="n">STATIC_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">&#39;wsgi&#39;</span><span class="p">,</span> <span class="s">&#39;static&#39;</span><span class="p">)</span>
<span class="n">MEDIA_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">&#39;wsgi&#39;</span><span class="p">,</span> <span class="s">&#39;static&#39;</span><span class="p">,</span> <span class="s">&#39;media&#39;</span><span class="p">)</span>
<span class="n">STATICFILES_DIRS</span> <span class="o">=</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">&#39;tuAppDjango&#39;</span><span class="p">,</span> <span class="s">&#39;static&#39;</span><span class="p">),)</span>
<span class="n">TEMPLATE_DIRS</span> <span class="o">=</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">&#39;tuAppDjango&#39;</span><span class="p">,</span> <span class="s">&#39;templates&#39;</span><span class="p">),)</span>
</pre></div>
<p>Para finalizar, tienes que reconocer si estás en OpenShift o no, para que use tu base de datos local o la del servidor.</p>
<p>En tu archivo settings.py, debes agregar:</p>
<div class="highlight"><pre><span class="o">...</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>

<span class="c"># Agregar esto!</span>
<span class="n">ON_OPENSHIFT</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">if</span> <span class="s">&#39;OPENSHIFT_REPO_DIR&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="n">ON_OPENSHIFT</span> <span class="o">=</span> <span class="bp">True</span>
<span class="c"># Fin</span>

<span class="o">...</span>

<span class="o">...</span>

<span class="c"># Database</span>
<span class="c"># https://docs.djangoproject.com/en/1.7/ref/settings/#databases</span>
<span class="c"># Agregar esto!</span>
<span class="k">if</span> <span class="n">ON_OPENSHIFT</span><span class="p">:</span>
    <span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">TEMPLATE_DEBUG</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;*&#39;</span><span class="p">]</span>
    <span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s">&#39;django.db.backends.mysql&#39;</span><span class="p">,</span>
            <span class="s">&#39;NAME&#39;</span><span class="p">:</span> <span class="s">&#39;tu-base-de-datos-OpenShift&#39;</span><span class="p">,</span>
            <span class="s">&#39;USER&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;OPENSHIFT_MYSQL_DB_USERNAME&#39;</span><span class="p">),</span>
            <span class="s">&#39;PASSWORD&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;OPENSHIFT_MYSQL_DB_PASSWORD&#39;</span><span class="p">),</span>
            <span class="s">&#39;HOST&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;OPENSHIFT_MYSQL_DB_HOST&#39;</span><span class="p">),</span>
            <span class="s">&#39;PORT&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;OPENSHIFT_MYSQL_DB_PORT&#39;</span><span class="p">),</span>
            <span class="p">}</span>
    <span class="p">}</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">TEMPLATE_DEBUG</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s">&#39;django.db.backends.sqlite3&#39;</span><span class="p">,</span>
            <span class="s">&#39;NAME&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">&#39;db.sqlite3&#39;</span><span class="p">),</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="c"># Fin</span>

<span class="o">...</span>
</pre></div>
<p>¡Recuerda reemplazar <strong>'tu-base-de-datos-OpenShift'</strong> con el nombre de la base de datos MySQL que te dió OpenShift!</p>
</div>
</div>
<div class="section" id="y-listo">
<h2>¡Y listo!</h2>
<p>Ya todo debería de estar funcionando. en tu terminal escribe:</p>
<div class="highlight"><pre>user@pc:~/repo<span class="nv">$ </span>git status
<span class="c"># Muestra todos los archivos que se van a agregar al commit</span>

user@pc:~/repo<span class="nv">$ </span>git add .
user@pc:~/repo<span class="nv">$ </span>git commit -m <span class="s2">&quot;Initial commit&quot;</span>
user@pc:~/repo<span class="nv">$ </span>git push
<span class="c"># Por ahí se nos va la app!</span>
</pre></div>
<p>Luego que termine el deployment de tu app, si visitas la URL deberías ver tu app corriendo sin ningún problema. Aveces me gusta revisar que la base de datos hizo bien las migraciones. Para eso usas PHPMyAdmin. Si no lo agregaste al comienzo del tutorial, puedes agregar el cartucho ahora.</p>
<p>Espero que hayas podido hacer tu deployment sin problema, y cualquier cosa, ¡No dudes en contactarme!.</p>
<p>Especiales agradecimientos al usuario <a class="reference external" href="http://stackoverflow.com/users/1105249/luis-masuelli">Luis Masuelli</a> de Stack-Overflow, que hizo <a class="reference external" href="http://stackoverflow.com/questions/26871381/deploying-a-local-django-app-using-openshift/26874375#26874375">este maravilloso aporte</a>.</p>
<p>Hasta la próxima.</p>
</div>

  </div>
  <div class="article_meta">
    <p>Posted on: 23/10/2015</p>
    <p>Category: <a href="http://rogergonzalez21.github.io/category/programacion/">Programación</a>
 &ndash; Tags:
      <a href="http://rogergonzalez21.github.io/tag/deploy/">deploy</a>,      <a href="http://rogergonzalez21.github.io/tag/django/">django</a>,      <a href="http://rogergonzalez21.github.io/tag/openshift/">openshift</a>,      <a href="http://rogergonzalez21.github.io/tag/python/">python</a>,      <a href="http://rogergonzalez21.github.io/tag/tutorial/">tutorial</a>    </p>
  </div>

  <div id="article_comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_identifier = "drafts/deploy-django-a-openshift/";
        (function() {
             var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
             dsq.src = 'http://rogergonzalez21.disqus.com/embed.js';
             (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
         })();
    </script>
  </div>

</article>


    <div id="ending_message">
      <p>&copy; Roger González. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. Theme by Giulio Fidente on <a href="https://github.com/gfidente/pelican-svbhack" target="_blank">github</a>. Forked and modified by Roger Gonzalez on <a href="https://github.com/Rogergonzalez21/pelican-svbhack" target="_blank">github</a>  </p>
    </div>
  </main>
</body>
</html>