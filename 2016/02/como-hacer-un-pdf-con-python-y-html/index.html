<!DOCTYPE html>
<html lang="en">

<head>
  <!-- ## for client-side less
  <link rel="stylesheet/less" type="text/css" href="http://localhost:8000/theme/css/style.less">
  <script src="http://cdnjs.cloudflare.com/ajax/libs/less.js/1.7.3/less.min.js" type="text/javascript"></script>
  -->
  <link rel="stylesheet" type="text/css" href="http://localhost:8000/theme/css/style.css">
  <link rel="stylesheet" type="text/css" href="http://localhost:8000/theme/css/pygments.css">
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=PT+Sans|PT+Serif|PT+Mono">
  <link rel="stylesheet" type="text/css" href="http://localhost:8000/theme/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="http://localhost:8000/theme/css/youtube.css">
  <link rel="shortcut icon" href="http://localhost:8000/images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="http://localhost:8000/images/favicon.ico" type="image/x-icon">
  <link rel="alternate" hreflang="es" href="rogerandresgonzalez.com.ve/es/" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Roger Andrés González">
  <meta name="description" content="Posts and writings by Roger Andrés González. Pythonista. Love to eat. Critic. Music lover. Always wanting to learn more.">
  <meta property="og:image" content="http://localhost:8000/images/yo.png" />
  <meta property="og:image:type" content="image/png" />
  <meta name="twitter:image" content="http://localhost:8000/images/yo.png" />
  <meta itemprop="image" content="http://localhost:8000/images/yo.png" />
  <link href="http://localhost:8000/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Roger Andrés González - rogerandresgonzalez.com.ve Atom" />

<meta name="keywords" content="python, pdf, reportes">

  <title>
    Roger Andrés González - rogerandresgonzalez.com.ve
&ndash; ¿Cómo hacer un PDF con Python y HTML?  </title>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-69257856-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>

<body>
  <aside class="gray_background">
    <div id="user_meta">
      <a href="http://localhost:8000">
        <img src="http://localhost:8000/images/yo.png" alt="logo">
        </a>
        <h2><a href="http://localhost:8000">Roger Andrés González</a></h2>
        <p>Pythonista. Love to eat. Critic. Music lover. Always wanting to learn more.</p>
        <ul>
        <ul class="social">
        <li><a class="sc-linkedin white" href="https://ve.linkedin.com/in/rogergonzalez21/en" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-github white" href="https://github.com/Rogergonzalez21" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-envelope-o white" href="mailto:me@rogerandresgonzalez.com.ve" target="_blank"><i class="fa fa-envelope-o"></i></a></li>
        <li><a class="sc-twitter white" href="https://twitter.com/RogerGonzalez21" target="_blank"><i class="fa fa-twitter"></i></a></li>
        </ul>
      </ul>
    </div>
  </aside>

  <main>

    <header>
      <p>
        / <a href="http://localhost:8000">Home</a> /
        <a href="/pages/about/">About</a> /
        <a href="/pages/curriculum/">Curriculum Vitae</a> /
        <a href="/archives/">Archive</a> /
        <a href="/category/">Category</a> /
        <a href="/tag/">Tags</a> /
        <a href="/es/">Español</a> /
        <a href="http://localhost:8000/feeds/all.atom.xml">Atom</a>
        </p>
    </header>
<!--
    <header>
      <p>
      <a href="http://localhost:8000">Index</a> &brvbar; <a href="http://localhost:8000/archives.html">Archives</a>
      &brvbar; <a href="http://localhost:8000/feeds/all.atom.xml">Atom</a>
      </p>
    </header>
-->
<article>
  <div class="article_title">
    <h3><a href="http://localhost:8000/2016/02/como-hacer-un-pdf-con-python-y-html/">¿Cómo hacer un PDF con Python y HTML?</a></h3>
  </div>
  <div class="article_text">
    <p>¿Alguna vez has tenido que hacer un reporte por medio de un PDF en tu aplicación de Python? Aquí puedes aprender como hacerlo, usando xhtml2pdf.</p>
<div class="section" id="que-es-xhtml2pdf">
<h2>¿Qué es xhtml2pdf?</h2>
<p>xhtml2pdf es un paquete que nos permite la creación de PDF's utilizando HTML. Aquí pueden encontrar la documentación completa.</p>
<div class="section" id="instalacion">
<h3>Instalación</h3>
<p>Primero, necesitamos instalar los paquetes necesarios. En el terminal, colocamos:</p>
<div class="highlight"><pre><span class="nv">$ </span>sudo apt-get install python-dev libjpeg-dev zlib1g-dev virtualenv
</pre></div>
<p>Ya que tenemos todo instalado, creamos una nueva virtualenv y la activamos.</p>
<div class="highlight"><pre><span class="nv">$ </span>virtualenv env
<span class="o">(</span>Se crea la virtualenv<span class="o">)</span>
<span class="nv">$ </span><span class="nb">source </span>env/bin/activate
<span class="o">(</span>env<span class="o">)</span> <span class="err">$</span>
</pre></div>
<p>Como siempre, para desactivar la virtualenv, <code>deactivate</code>.</p>
<p>Ya que estamos en nuestra virtualenv, instalamos desde pip:</p>
<div class="highlight"><pre><span class="o">(</span>env<span class="o">)</span> <span class="nv">$ </span>pip install xhtml2pdf jinja2
<span class="o">(</span>Se instalan los paquetes<span class="o">)</span>
</pre></div>
<p>¡Y eso es todo! Ya podemos empezar a crear nuestro primer PDF.</p>
</div>
</div>
<div class="section" id="creando-nuestro-primer-pdf">
<h2>Creando nuestro primer PDF</h2>
<p>Por lo general, hay 3 formas de crear PDF's con xhtml2PDF:</p>
<ul class="simple">
<li>Con un HTML estático</li>
<li>Con un HTML dinámico</li>
<li>Con un framework web (Django, Flask, Pyramid, etc.)</li>
</ul>
<div class="section" id="con-un-html-estatico">
<h3>Con un HTML estático</h3>
<p>Si solo necesitamos generar un reporte de un HTML estático, solo necesitamos lo siguiente:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">xhtml2pdf</span> <span class="kn">import</span> <span class="n">pisa</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">)))</span>

<span class="n">sourceHtml</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s">&#39;ruta/a/nuestro/HTML&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">outputFilename</span> <span class="o">=</span> <span class="s">&quot;test.pdf&quot;</span>

<span class="k">def</span> <span class="nf">convertHtmlToPdf</span><span class="p">(</span><span class="n">sourceHtml</span><span class="p">,</span> <span class="n">outputFilename</span><span class="p">):</span>
    <span class="n">resultFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFilename</span><span class="p">,</span> <span class="s">&quot;w+b&quot;</span><span class="p">)</span>

    <span class="n">pisaStatus</span> <span class="o">=</span> <span class="n">pisa</span><span class="o">.</span><span class="n">CreatePDF</span><span class="p">(</span>
            <span class="n">sourceHtml</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="n">resultFile</span><span class="p">)</span>

    <span class="n">resultFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">pisaStatus</span><span class="o">.</span><span class="n">err</span>

<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">pisa</span><span class="o">.</span><span class="n">showLogging</span><span class="p">()</span>
    <span class="n">convertHtmlToPdf</span><span class="p">(</span><span class="n">sourceHtml</span><span class="p">,</span> <span class="n">outputFilename</span><span class="p">)</span>
</pre></div>
<p>Iré explicando poco a poco.</p>
<ol class="arabic simple">
<li>Importamos pisa (para renderizar los PDF) y os (para ubicar nuestro archivo HTML).</li>
<li>Usamos os para leer nuestro archivo HTML y le asignamos un nombre a nuestro resultado en PDF.</li>
<li>Creamos una función llamada convertHtmlToPdf, la cual recibe el HTML a renderizar y el nombre del PDF que estamos generando.</li>
<li>En la función, creamos el archivo y renderizamos el PDF con pisa.CreatePDF(), definiendo nuestro HTML y el archivo PDF creado.</li>
<li>Por último, cerramos el archivo, devolvemos los errores (en caso de existir errores) y corremos el main</li>
</ol>
<p>Bastante sencillo. Podemos tener un HTML como este:</p>
<div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Hola mundo!<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
    Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
    tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
    quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
    consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
    cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
    proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
<span class="nt">&lt;/p&gt;</span>
</pre></div>
<p>Y nos devolvería exactamente lo mismo, pero en un PDF.</p>
<p>El problema de esta solución, es que no es automático. Si tenemos un script que genere cierto contenido, tendríamos que modificar el HTML a mano para crear nuestro PDF. Por eso vamos a la segunda forma de crear un PDF</p>
</div>
<div class="section" id="con-un-html-dinamico">
<h3>Con un HTML dinámico</h3>
<p>Para hacer uso de un HTML dinámico, vamos a cargar nuestros templates con jinja2, el compilador de HTML de Django.</p>
<p>Para eso, modificamos un poco nuestro script original:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">xhtml2pdf</span> <span class="kn">import</span> <span class="n">pisa</span>
<span class="kn">from</span> <span class="nn">jinja2</span> <span class="kn">import</span> <span class="n">Template</span> <span class="c">#Nuevo!</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">)))</span>

<span class="n">sourceHtml</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s">&#39;ruta/a/nuestro/HTML&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">outputFilename</span> <span class="o">=</span> <span class="s">&quot;test.pdf&quot;</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;name&#39;</span> <span class="p">:</span> <span class="s">&#39;roger&#39;</span><span class="p">,</span> <span class="s">&#39;lastname&#39;</span> <span class="p">:</span> <span class="s">&#39;gonzalez&#39;</span><span class="p">}</span> <span class="c">#Nuevo!</span>

<span class="k">def</span> <span class="nf">convertHtmlToPdf</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sourceHtml</span><span class="p">,</span> <span class="n">outputFilename</span><span class="p">):</span> <span class="c">#Nuevo!</span>
    <span class="n">resultFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFilename</span><span class="p">,</span> <span class="s">&quot;w+b&quot;</span><span class="p">)</span>

    <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">sourceHtml</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">())</span> <span class="c">#Nuevo!</span>
    <span class="n">html</span>  <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="c">#Nuevo!</span>

    <span class="n">pisaStatus</span> <span class="o">=</span> <span class="n">pisa</span><span class="o">.</span><span class="n">CreatePDF</span><span class="p">(</span>
            <span class="n">html</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="n">resultFile</span><span class="p">)</span>
    <span class="n">resultFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">pisaStatus</span><span class="o">.</span><span class="n">err</span>

<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">pisa</span><span class="o">.</span><span class="n">showLogging</span><span class="p">()</span>
    <span class="n">convertHtmlToPdf</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sourceHtml</span><span class="p">,</span> <span class="n">outputFilename</span><span class="p">)</span>
</pre></div>
<p>¿Qué hacen las lineas nuevas?</p>
<ol class="arabic simple">
<li>Importamos Template, que nos permitirá renderizar automáticamente los HTML.</li>
<li>Creamos un nuevo diccionario y lo añadimos a la función. jinja2 usa diccionarios para renderizar los datos en HTML.</li>
<li>Usamos Template para abrir nuestro HTML y posteriormente renderizarlo con nuestro diccionario data</li>
</ol>
<p>Lo mejor de este método es que no es necesario estar pendiente de los HTML. Solo debes hacer una base y utilizar el poderoso sintaxis de jinja2.</p>
<p>Puedes tener este HTML:</p>
<p>&lt;h1&gt;Hola mundo!&lt;/h1&gt;
&lt;p&gt;{{ name }} {{ lastname }}&lt;/p&gt;</p>
<p>El cual devolvería este PDF:</p>
</div>
</div>
<div class="section" id="hola-mundo">
<h2>Hola mundo!</h2>
<p>roger gonzalez</p>
<p>Este es el método que más uso, cuando necesito que un script me devuelva un PDF para mandarlo por correo.</p>
<p>Por último, pero no menos importante, el método de framework web.</p>
<div class="section" id="con-un-html-de-un-framework-web">
<h3>Con un HTML de un framework web</h3>
<p>Este método es muy parecido al anterior, a excepción del uso de link callbacks para convertir los URIs de los HTML a rutas absolutas. Para este ejemplo, estoy usando Django.</p>
<div class="highlight"><pre>from django.conf import settings
from django.http import HttpResponse
from django.template import Context
from django.template.loader import get_template

from xhtml2pdf import pisa


def link_callback(uri, rel):

    sUrl = settings.STATIC_URL      # Typically /static/
    sRoot = settings.STATIC_ROOT    # Typically /home/userX/project_static/
    mUrl = settings.MEDIA_URL       # Typically /static/media/
    mRoot = settings.MEDIA_ROOT     # Typically /home/userX/project_static/media/

    if uri.startswith(mUrl):
        path = os.path.join(mRoot, uri.replace(mUrl, &quot;&quot;))
    elif uri.startswith(sUrl):
        path = os.path.join(sRoot, uri.replace(sUrl, &quot;&quot;))
    else:
        return uri

    if not os.path.isfile(path):
            raise Exception(
                &#39;media URI must start with %s or %s&#39; % (sUrl, mUrl)
            )
    return path

def generate_pdf(request):

    data = {}
    data[&#39;today&#39;] = datetime.date.today()
    data[&#39;farmer&#39;] = &#39;Old MacDonald&#39;
    data[&#39;animals&#39;] = [(&#39;Cow&#39;, &#39;Moo&#39;), (&#39;Goat&#39;, &#39;Baa&#39;), (&#39;Pig&#39;, &#39;Oink&#39;)]

    template = get_template(&#39;lyrics/oldmacdonald.html&#39;)
    html = template.render(Context(data))

    f = open(os.path.join(settings.MEDIA_ROOT, &#39;test.pdf&#39;), &quot;w+b&quot;)
    pisaStatus = pisa.CreatePDF(html, dest=f, link_callback=link_callback)

    file.seek(0)
    pdf = file.read()
    file.close()
    return HttpResponse(pdf, mimetype=&#39;application/pdf&#39;)
</pre></div>
<p>Más de lo mismo, lo único que cambia es que al final devuelve el PDF por medio de un HttpResponse de Django.
¡Eso es todo!</p>
<p>Con este tutorial corto, pero informativo, pudimos aprender como usar xhtml2pdf para generar un reporte en PDF utilizando un HTML como base. Pero eso no es todo. xhtml2pdf tiene algunas limitaciones a la hora de renderizar HTML. Puedes conocerlas todas revisando la documentación.</p>
<p>¡Hasta la próxima!</p>
</div>
</div>

  </div>
  <div class="article_meta">
    <p>Posted on: 09/02/2016</p>
    <p>Category: <a href="http://localhost:8000/category/programacion/">Programación</a>
 &ndash; Tags:
      <a href="http://localhost:8000/tag/python/">python</a>,      <a href="http://localhost:8000/tag/pdf/">pdf</a>,      <a href="http://localhost:8000/tag/reportes/">reportes</a>    </p>
  </div>

  <div id="article_comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_identifier = "2016/02/como-hacer-un-pdf-con-python-y-html/";
        (function() {
             var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
             dsq.src = 'http://rogergonzalez21.disqus.com/embed.js';
             (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
         })();
    </script>
  </div>

</article>


    <div id="ending_message">
      <p>&copy; Roger Andrés González. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. Theme by Giulio Fidente on <a href="https://github.com/gfidente/pelican-svbhack" target="_blank">github</a>. Forked and modified by Roger Gonzalez on <a href="https://github.com/Rogergonzalez21/pelican-svbhack" target="_blank">github</a>  </p>
    </div>
  </main>
</body>
</html>